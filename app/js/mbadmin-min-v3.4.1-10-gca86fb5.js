var MBBAdmin=new Class({Extends:MBBall,initialize:function(b,g,a,d,f){this.parent(a);var e={cid:g,rid:0};var c;this.competitions=new MBB.subPage(this,"competitions.php",$("competitions"),function(i){var h=this.owner;$$("input.default").each(function(k,j){if(e.cid==0&&k.checked){e.cid=k.value}k.addEvent("change",function(m){var l=new MBB.req("setdefault.php",function(n){if(e.cid==0){e.cid=n.cid;h.competition.loadPage(e)}});if(e.cid==0&&k.checked){e.cid=k.value}l.post($("default_competition"))})});i.getElements(".selectthis").each(function(j,k){j.addEvent("click",function(l){l.stop();e.cid=j.id.substr(1).toInt();e.rid=0;h.competition.loadPage(e)})});i.getElements(".del").each(function(j,k){j.addEvent("click",function(l){l.stop();if(confirm(d.deletecomp)){var m=new MBB.req("deletecomp.php",function(n){if(e.cid==n.cid){e.cid=0;e.rid=0;h.competition.loadPage(e)}h.competitions.loadPage(e)});m.get({cid:j.id.substr(1).toInt()})}})});$("createform").addEvent("submit",function(k){k.stop();if(MBB.textValidate($("desc"))){var j=new MBB.req("createcomp.php",function(l){if(e.cid==0||$("def").checked){e.cid=l.cid;e.rid=0;h.competition.loadPage(e)}h.competitions.loadPage(e)});j.post($("createform"))}})});this.competition=new MBB.subPage(this,"competition.php",$("competition"),function(m){var l;var h=this.owner;if(e.cid!=0){var k=$("playoffdeadline");var i=k.value;var j=new Calendar.Single(k,{format:"j M Y g:i a (D)",width:"235px",onHideStart:function(){if(new Date(k.value*1000)>new Date()||confirm(d.deadline)){i=k.value;k.fireEvent("change")}else{k.value=i;j.resetVal()}return true}});m.getElements("input").append(m.getElements("select")).append(m.getElements("textarea")).addEvent("change",function(o){if(this.id=="bbapproval"){$$("#registered input.bbapprove").each(function(r){r.readOnly=!o.target.checked})}var p=true;if(!MBB.intValidate($("gap"))){p=false}if(p&this.name=="condition"){var n=this.retrieve("old");this.store("old",this.value);if(n==this.value){p=false}}if(p){var q=new MBB.req("updatecomp.php",function(r){h.competitions.loadPage(e);$("userpick").empty()});q.post($("compform"))}});if(c){c.addTextareas(m.getElements("textarea"))}else{c=new MBB.emoticon($("emoticons"),$("content").getElements("textarea"))}}this.rounds=new MBB.subPage(this,"rounds.php",$("rounds"),function(p){this.round=new MBB.subPage(this,"round.php",$("round"),function(A){var B;var z;var v=false;$("userpick").empty();var x=function(K){var P=$("ou");if(!P.checked){K.getElement("input[name=cscore]").readOnly=true}var Q=K.getElement("input[name=mtime]");var T=Q.value;var L=new Calendar.Single(Q,{format:"D j M g:ia",width:"172px",onHideStart:function(){if(new Date(Q.value*1000)>new Date()||confirm(d.matchtime)){T=Q.value;Q.fireEvent("change")}else{Q.value=T;L.resetVal()}return true}});K.getElements("input[type=text]").append(K.getElements("input[type=checkbox]")).append(K.getElements("textarea")).append(K.getElements("input[name=mtime]")).addEvent("change",function(W){if(W){W.stop()}var X=true;if(X&&(this.name=="cscore"||this.name=="ascore"||this.name=="hscore")){if(!MBB.intValidate(this)){X=false}}if(X&&this.name=="open"&&this.checked){var U=K.getElement("input[name=hid]");if(U.value==""||U.value==null){this.checked=false;X=false;U.highlight("#F00")}if(X&&(Q.value==""||Q.value==0)){if(!confirm(d.nomatchdate)){X=false;this.checked=false}}}if(X&&this.name=="comment"){var V=this.retrieve("old");this.store("old",this.value);if(V==this.value){X=false}}if(X){var Y=new MBB.req("updatematch.php",function(Z){$("userpick").empty()});Y.post(K.getElement("form"))}});K.getElement(".aid").addEvent("click",function(W){W.stop();var U=K.getElement("input[name=hid]");if(U.value!=null&&U.value!=""){var V=new MBB.req("switchaid.php",function(X){K.getElement("input[name=aid]").value=X.aid;U.value=X.hid;W.target.set("text",X.aid);K.getElement(".hid").getFirst().set("text",X.hid);$("userpick").empty()});V.get(Object.merge(e,{aid:this.getElement("span").get("text")}))}});K.getElement(".hid").addEvent("click",function(X){X.stop();var U=K.getElement("input[name=hid]");if(U.value!=null&&U.value!=""){var W=K.getElement("input[name=open]");if(W.checked){W.highlight("#F00")}else{var V=new MBB.req("removehid.php",function(Y){U.value=null;X.target.set("text","---");$("T"+Y.hid).removeClass("inmatch");$("userpick").empty()})}V.get(Object.merge(e,{haid:K.getElement("input[name=aid]").value}))}});K.getElement(".del").addEvent("click",function(V){V.stop();v=true;var U=new MBB.req("matchrefers.php",function(W){if(W.referers==0||confirm(d.deletematch)){var X=new MBB.req("deletematch.php",function(Z){v=false;K.dispose();if(Z.cid!=0){$("T"+Z.aid).removeClass("inmatch");var Y=$("T"+Z.hid);if(Y){Y.removeClass("inmatch")}}$("userpick").empty()});X.get(Object.merge(e,{aid:K.getElement("input[name=aid]").value}))}else{v=false}});U.get(Object.merge(e,{aid:K.getElement("input[name=aid]").value}))});var R=K.getElement("input[name=underdog]");var J=false;var O=R.value.toInt();if(O<0){J=true;O=-O}var S=f.underdog.indexOf(O);if(S<0){S=0}if(J&&S>0){S=-S;K.getElement(".aid").getElement("span").addClass("isUnderdog");K.getElement(".open").addClass("isUnderdog")}else{if(S!=0){K.getElement(".hid").getElement("span").addClass("isUnderdog");K.getElement(".open").addClass("isUnderdog")}}var N=K.getElement(".slider");var M=N.getElement(".knob");new Slider(N,M,{minstep:-5,maxstep:5,initial:S,minortick:1,majortick:10,onTick:function(U){M.set("text",f.underdog[Math.abs(U)])},onChange:function(U){if(U==0){K.getElement(".aid").getElement("span").removeClass("isUnderdog");K.getElement(".hid").getElement("span").removeClass("isUnderdog");K.getElement(".open").removeClass("isUnderdog");R.value=0}else{if(U<0){K.getElement(".aid").getElement("span").addClass("isUnderdog");K.getElement(".hid").getElement("span").removeClass("isUnderdog");K.getElement(".open").addClass("isUnderdog");R.value=-f.underdog[-U]}else{K.getElement(".hid").getElement("span").addClass("isUnderdog");K.getElement(".aid").getElement("span").removeClass("isUnderdog");K.getElement(".open").addClass("isUnderdog");R.value=f.underdog[U]}}var V=new MBB.req("updatematch.php",function(W){$("userpick").empty()});V.post(K.getElement("form"))}})};var G=function(K){K.stop();if(this.checked){var J=new MBB.req("changeselans.php",function(L){B=L.opid;$("answer").value=B});J.get(Object.merge(e,{opid:this.value}))}};var s=function(K){K.stop();if(MBB.textValidate(this)){var J=new MBB.req("changeans.php",function(L){});J.get(Object.merge(e,{opid:this.name,label:this.value}))}};var H=function(K){K.stop();var J=new MBB.req("deleteans.php",function(M){K.target.getParent().getParent().dispose();var L=$("nullanswer").getParent().getParent();if(L.getNext()==null){L.dispose();$("answer").readOnly=false;$("answer").value="";B=0;z=0}else{if(M.opid==B){$("nullanswer").checked=true;$("answer").value=0;B=0}}$("userpick").empty()});J.get(Object.merge(e,{opid:this.get("id").substr(1).toInt()}))};if(e.rid!=0){MBB.adjustDates(A);elAns=$("answer");if(elAns.value==""){B=0}else{B=elAns.value.toInt()}var D=$("deadline");var r=D.value;var C=new Calendar.Single(D,{format:"j M Y g:i a (D)",width:"235px",onHideStart:function(){if(new Date(D.value*1000)>new Date()||confirm(d.quesdead)){r=D.value;D.fireEvent("change")}else{D.value=r;C.resetVal()}return true}});A.getElements("input").append(A.getElements("textarea")).addEvent("change",function(M){if(this.id=="ou"){$("matches").getElements("input[name=cscore]").each(function(P){P.readOnly=!M.target.checked})}var N=true;if(!MBB.intValidate($("value"))){N=false}if(!MBB.intValidate(elAns)){N=false}if(!MBB.textValidate($("rname"))){N=false}if(N&this.name=="question"){var L=this.retrieve("old");this.store("old",this.value);if(L==this.value){N=false}}if(N&&this.name=="open"&&this.checked){var J=$("matches").getElements("input[name=open]");if(J.length==0||J.every(function(P){return(!P.checked)})){if(!confirm(d.nomatchround)){N=false;this.checked=false}}}if(N){var O=new MBB.req("updateround.php",function(P){$("userpick").empty()});var K=A.getElement("input[name=cache]");if(this.name=="open"){K.value=true}else{K.value=A.getElement("input[name=open]").checked}O.post(document.id("roundform"))}});var F=A.getElement("input[name=value]");var q=document.id("pointsslider").getElement(".slider");var E=q.getElement(".knob");var t=f.points.indexOf(F.value.toInt());if(t<0){t=0}new Slider(q,E,{minstep:0,maxstep:6,initial:t,minortick:1,majortick:10,onTick:function(J){E.set("text",f.points[J])},onChange:function(J){F.value=f.points[J];var K=new MBB.req("updateround.php",function(L){$("userpick").empty()});K.post($("roundform"))}});var u=A.getElement("input[name=bvalue]");var y=document.id("bonusslider").getElement(".slider");var w=y.getElement(".knob");var I=f.bonus.indexOf(u.value.toInt());if(I<0){I=0}new Slider(y,w,{minstep:0,maxstep:6,initial:I,minortick:1,majortick:10,onTick:function(J){w.set("text",f.bonus[J])},onChange:function(J){u.value=f.bonus[J];var K=new MBB.req("updateround.php",function(L){$("userpick").empty()});K.post($("roundform"))}});$("option").addEvent("click",function(K){K.stop();if(typeof(z)=="number"){var J=new MBB.req("createoption.php",function(L){$("answer").readOnly=true;if(z==0){var M=new Element("tr").adopt(new Element("td").adopt(new Element("input",{id:"nullanswer",type:"radio",name:"option",value:0,checked:true,events:{change:G}}))).adopt(new Element("td",{colspan:2}).adopt(new Element("span",{text:"No Answer Set Yet"}))).inject($("optionform").getElement("tbody"));B=0;$("answer").value=0}var N=new Element("tr").adopt(new Element("td").adopt(new Element("input",{type:"radio",name:"option","class":"option_select",value:L.opid,events:{change:G}}))).adopt(new Element("td").adopt(new Element("input",{type:"text",name:L.opid,"class":"option_input",events:{change:s}}))).adopt(new Element("td").adopt(new Element("div",{id:"O"+L.opid,"class":"del",events:{click:H}}))).inject($("optionform").getElement("tbody"));z=L.opid;$("userpick").empty()});J.get(Object.merge(e,{opid:z+1}))}});if(c){c.addTextareas(A.getElements("textarea"))}else{c=new MBB.emoticon($("emoticons"),$("content").getElements("textarea"))}}else{B=0}this.matches=new MBB.subPage(this,"matches.php",$("matches"),function(J){if(e.cid!=0&&e.rid!=0){MBB.adjustDates(J);J.getElements(".match").each(function(K){x(K)});if(c){c.addTextareas(J.getElements("textarea"))}else{c=new MBB.emoticon($("emoticons"),$("content").getElements("textarea"))}}$("userpick").empty()});this.options=new MBB.subPage(this,"options.php",$("options"),function(K){if(e.cid!=0&&e.rid!=0){z=$("noopts").value.toInt();if(z!=0){$("answer").readOnly=true;$("nullanswer").addEvent("change",G);var J=$("optionform");J.getElements(".option_select").addEvent("change",G);J.getElements(".option_input").addEvent("change",s);J.getElements(".del").addEvent("click",H)}}$("userpick").empty()});this.teams=new MBB.subPage(this,"teams.php",$("teams"),function(J){if(e.cid!=0){var P=$("lock");var O=false;var Q;var M=function(W){W.stop();var U=this;if(!P.checked){if(!O){O=true;var V=new MBB.req("remtic.php",function(Y){if(Y.OK){var aa=new Element("div",{id:"S"+Y.tid,"class":"tic"});var Z=new Element("span",{"class":"tid",events:{click:Q},text:Y.tid}).inject(aa);if($$("#tnic div").every(function(ac,ab){if(ac.getElement("span").get("text")>Y.tid){aa.inject(ac,"before");return false}return true})){$("tnic").adopt(aa)}U.getParent().dispose();if(document.id("P"+Y.tid)){document.id("P"+Y.tid).dispose()}}else{alert(d.constraint)}O=false});V.get({cid:e.cid,tid:U.get("text")})}}else{if(!v&&e.rid!=0){if(!this.getParent().hasClass("inmatch")){var X=this.get("text");if($$(".match").every(function(aa){var Y=aa.getElement("input[name=hid]");if(Y.value==""){var Z=new MBB.req("addhid.php",function(ab){if(ab.hid!="---"){Y.value=X;aa.getElement("div.hid").getFirst().set("text",X);U.getParent().addClass("inmatch")}v=false});v=true;Z.get(Object.merge(e,{aid:aa.getElement("input[name=aid]").value,hid:X}));return false}return true})){var T=new Element("div",{"class":"match"});T.inject($("matches"));var S=new MBB.subPage(this,"creatematch.php",T,function(Y){if(!$("ou").checked){T.getElement("input[name=cscore]").readOnly=true}x(T);U.getParent().addClass("inmatch");v=false});matchupdateLocked=true;S.loadPage(Object.merge(e,{aid:X}))}}}}};var R=function(T){var S=new MBB.req("updatepostate.php",function(U){});S.get({cid:e.cid,tid:this.name,mp:this.checked})};var N=function(T){var V=new Element("div",{id:"T"+T,"class":"tic"});var S=new Element("input",{type:"checkbox",name:T,events:{change:R}}).inject(V);var U=new Element("span",{"class":"tid",events:{click:M},text:T}).inject(V);return V};var K=function(X,T,W,V){var S=f.playoff.indexOf(W.toInt());if(S<0){S=0}var U=new Slider(X,T,{minstep:1,maxstep:5,initial:S+1,minortick:1,onTick:function(Y){T.set("text",f.playoff[Y-1])},onChange:function(Z){var Y=new MBB.req("setposcore.php",function(aa){});Y.get({cid:e.cid,tid:V,pscore:f.playoff[Z-1]})}})};var L=function(U,T,V){var X=new Element("div",{id:"P"+U,"class":"tic"});var W=new Element("div",{"class":"pslide"});var S=new Element("div",{"class":"knob",text:"1"}).inject(W);W.inject(X);if(T=="b"){X.inject(V,"before")}if(T=="a"){V.adopt(X)}K(W,S,1,U);return};document.id("pop").getElements("div.tic").each(function(T){var U=T.getElement(".pslide");var S=U.getElement(".knob");K(U,S,S.get("text"),T.get("id").substring(1))});Q=function(U){U.stop();if(!P.checked){if(!O){O=true;var T=this;var S=new MBB.req("addtic.php",function(V){var W=N(V.tid);if($$("#tic div").every(function(Z,Y){var X=Z.getElement("span").get("text");if(X>V.tid){W.inject(Z,"before");L(V.tid,"b",document.id("P"+X));return false}return true})){$("tic").adopt(W);L(V.tid,"a",document.id("pop"))}T.getParent().dispose();O=false});S.get({cid:e.cid,tid:T.get("text")})}}else{$("lock_cell").highlight("#F00")}};$$("#tic span").addEvent("click",M);$$("#tnic span").addEvent("click",Q);$$("#tic input").addEvent("change",R);$("addall").addEvent("click",function(T){T.stop();if(!P.checked){if(!O){var S=new MBB.req("addalltic.php",function(V){O=false;var W=V.teams;$("tnic").empty();var X=$("tic").empty();var U=document.id("pop").empty();W.each(function(Y,Z){X.adopt(N(Y));L(Y,"a",U)})});O=true;S.get({cid:e.cid})}}else{$("lock_cell").highlight("#F00")}});P.addEvent("change",function(S){S.stop();if(P.checked){document.id("tnichead").addClass("hidden");document.id("tnic").addClass("hidden");document.id("pophead").removeClass("hidden");document.id("pop").removeClass("hidden")}else{document.id("pophead").addClass("hidden");document.id("pop").addClass("hidden");document.id("tnichead").removeClass("hidden");document.id("tnic").removeClass("hidden")}})}});if(e.rid!=0){this.matches.loadPage(Object.merge(e,{ou:$("ou").checked}));this.options.loadPage(Object.merge(e,{answer:B}))}else{this.matches.loadPage(e);this.options.loadPage(e)}this.teams.loadPage(e)});if(e.cid!=0){if(e.rid==0){if(p.getElement("div")){e.rid=p.getElement("div").get("id").substr(1).toInt()}else{e.rid=0}l=e.rid;if(e.rid!=0){var o=0;var n=p.getElements("input[name=open]");n.each(function(q){if(q.value!=0){o=Math.max(o,q.value)}});if(o!=0){e.rid=o}}}this.round.loadPage(e);if(e.rid!=0){p.getElements(".selectthis").each(function(q,r){q.addEvent("click",function(s){s.stop();e.rid=q.id.substr(1).toInt();h.competition.rounds.round.loadPage(e)})});p.getElements(".del").each(function(q,r){q.addEvent("click",function(s){s.stop();if(confirm(d.deleteround)){var t=new MBB.req("deleteround.php",function(u){l--;if(e.cid==u.cid&&e.rid==u.rid){e.rid=0;h.competition.rounds.round.loadPage(e)}if(e.cid==u.cid&&e.rid>u.rid){e.rid--;h.competition.rounds.round.loadPage(e)}h.competition.rounds.loadPage(e)});t.get({cid:e.cid,rid:q.id.substr(1).toInt()})}})})}}this.newround=new MBB.subPage(this,"newround.php",$("newround"),function(q){if(e.cid!=0){$("createroundform").addEvent("submit",function(s){s.stop();var r=new MBB.req("createround.php",function(t){l++;h.competition.rounds.loadPage(e)});r.post($("createroundform"))})}});this.adminreg=new MBB.subPage(this,"adminreg.php",$("registered"),function(s){var q=this.owner;this.adminpick=new MBB.subPage(this,"adminpick.php",$("userpick"),function(v){if($("pick")){MBB.adjustDates(v);this.teams=new Object({});this.lastpick=new Object({});var t=v.getElements(".ppick");var u=this;t.each(function(w){if(w.checked){u.teams[w.value]=w;u.lastpick[w.name]=w}});t.addEvent("change",function(y){y.stop();var x=u.lastpick[this.name];if(u.teams[this.value]!=undefined){var w=u.teams[this.value];w.getParent().highlight("#F00");this.checked=false;if(x){x.checked=true}}else{u.teams[this.value]=this;v.getElement("input[name=P"+this.value+"]").value="yes";if(x){delete u.teams[x.value]}delete u.lastpick[this.name];u.lastpick[this.name]=this}});v.getElements("input.opt_pick").addEvent("change",function(w){w.stop();document.id("admin_answer").value="yes"});v.getElements("input.match_pick").addEvent("change",function(w){w.stop();v.getElement("input[name=A"+this.name.substr(1)+"]").value="yes"});$("make_picks").addEvent("click",function(y){y.stop();var z=true;var x=$("answer");if(x){if(!MBB.intValidate(x)){z=false;x.value=""}}var w=new MBB.req("createpicks.php",function(A){if(z){if(typeof(ga)==="function"){ga("send","pageview","/football/picks/adminmade")}document.id("pick").dispose()}else{$("bonus_pick").getElement("textarea").value=d.noquestion}});w.post($("pick"))});document.id("cancel_picks").addEvent("click",function(w){w.stop();document.id("pick").dispose()})}});if(e.cid!=0){MBB.adjustDates(s);$$("#registered input.gapprove").addEvent("change",function(u){u.stop();if(confirm(d.approve)){var t=new MBB.req("gapprove.php",function(v){});t.get(Object.merge(e,{bbuid:this.name,approval:this.checked}))}else{this.checked=!this.checked}});s.getElements(".del").each(function(t,u){t.addEvent("click",function(v){v.stop();if(confirm(d.unregister)){var w=new MBB.req("deleteregistration.php",function(x){q.adminreg.loadPage(Object.merge(e,{bbar:$("bbapproval").checked}))});w.get({cid:e.cid,ruid:t.id.substr(1).toInt()})}})});var r=this;s.getElements(".user_name").addEvent("click",function(t){t.stop();r.adminpick.loadPage(Object.merge(e,{auid:this.get("id").substr(1),name:this.get("text"),gap:$("gap").value,pod:$("playoffdeadline").value}))})}});this.newround.loadPage(Object.merge(e,{mr:l+1}));this.adminreg.loadPage(Object.merge(e,{bbar:$("bbapproval").checked}))});this.rounds.loadPage(e)});if(b){Object.append(e,{global:true})}this.competitions.loadPage(e);this.competition.loadPage(e)}});