var Slider=new Class({Implements:[Events,Options],Binds:["doDrag","sliderClick","sliderScroll"],options:{minstep:0,maxstep:100,initial:0,minortick:0,minorclass:"minortick",majortick:0,majorclass:"majortick",wheel:false,mode:"horizontal"},initialize:function(a,b,j){this.setOptions(j);this.slider=document.id(a);this.knob=document.id(b);var g=this.slider.getSize();var c=this.knob.getSize();this.steps=this.options.maxstep-this.options.minstep;this.previousStep=this.options.initial;var d={x:[0,0],y:[0,0]};var h={x:false,y:false};switch(this.options.mode){case"vertical":this.axis="y";this.property="bottom";this.pixelsPerStep=Math.floor((g.y-c.y)/this.steps);this.offset=Math.round((g.y-c.y-(this.pixelsPerStep*this.steps))/2);d.y=[this.offset,this.offset+(this.pixelsPerStep*this.steps)];h.y=this.property;this.halfKnob=Math.round(c.y/2);break;case"horizontal":this.axis="x";this.property="left";this.pixelsPerStep=Math.floor((g.x-c.x)/this.steps);this.offset=Math.round((g.x-c.x-(this.pixelsPerStep*this.steps))/2);d.x=[this.offset,this.offset+(this.pixelsPerStep*this.steps)];h.x=this.property;this.halfKnob=Math.round(c.x/2);break}if(this.slider.getStyle("position")!="relative"){this.slider.setStyle("position","relative")}if(this.knob.getStyle("position")!="absolute"){this.knob.setStyle("position","absolute")}this.knob.setStyle(this.property,this.offset+(this.options.initial-this.options.minstep)*this.pixelsPerStep);if(this.options.minortick!=0||this.options.majortick!=0){var f;var e;for(i=this.options.minstep;i<=this.options.maxstep;i++){e=this.offset+(i-this.options.minstep)*this.pixelsPerStep+this.halfKnob;if(this.options.majortick!=0&&i%this.options.majortick==0){f=new Element("div",{"class":this.options.majorclass,position:"absolute"});f.setStyle(this.property,e);f.inject(this.slider,"top")}else{if(this.options.minortick!=0&&i%this.options.minortick==0){f=new Element("div",{"class":this.options.minorclass,position:"absolute"});f.setStyle(this.property,e);f.inject(this.slider,"top")}}}}this.drag=new Drag(this.knob,{grid:this.pixelsPerStep,limit:d,invert:(this.options.mode=="vertical"),modifiers:h,snap:Math.floor(this.pixelsPerStep/2),onBeforeStart:(function(){this.isDragging=true}).bind(this),onDrag:this.doDrag,onComplete:(function(){this.doDrag();this.isDragging=false;if(this.step!=this.previousStep){this.fireEvent("change",this.step)}this.previousStep=this.step}).bind(this),onCancel:(function(){this.isDragging=false}).bind(this),onStart:this.doDrag});this.attach()},attach:function(){this.slider.addEvent("mousedown",this.sliderClick);if(this.options.wheel){this.slider.addEvent("mousewheel",this.sliderScroll)}this.drag.attach();return this},detach:function(){this.slider.removeEvent("mousedown",this.sliderClick).removeEvent("mouswheel",this.sliderScroll);this.drag.detach();return this},getStep:function(a){var b;if(a<this.offset){b=this.options.minstep}else{if(a>this.offset+(this.steps*this.pixelsPerStep)){b=this.options.maxstep}else{b=Math.round((a-this.offset)/this.pixelsPerStep)+this.options.minstep}}return b},sliderClick:function(c){var a;if(this.isDragging||c.target==this.knob){return}if(this.axis=="y"){a=this.slider.getSize().y-(c.page.y-this.slider.getPosition().y)-this.halfKnob}else{a=c.page.x-this.slider.getPosition().x-this.halfKnob}var b=this.getStep(a);this.knob.setStyle(this.property,this.offset+(b-this.options.minstep)*this.pixelsPerStep);this.fireEvent("tick",b);if(this.previousStep!=b){this.fireEvent("change",b)}this.previousStep=b},sliderScroll:function(b){if(this.isDragging){return}var a=this.previousStep;if(b.wheel<0){if(this.previousStep>this.options.minstep){this.previousStep--;this.knob.setStyle(this.property,this.offset+(this.previousStep-this.options.minstep)*this.pixelsPerStep)}}else{if(this.previousStep<this.options.maxstep){this.previousStep++;this.knob.setStyle(this.property,this.offset+(this.previousStep-this.options.minstep)*this.pixelsPerStep);this.fireEvent("tick",this.previousStep).fireEvent("change",this.previousStep)}}this.fireEvent("tick",this.previousStep);if(a!=this.previousStep){this.fireEvent("change",this.previousStep)}},doDrag:function(){var a;if(this.axis=="y"){a=this.slider.getSize().y-this.knob.getPosition(this.slider).y}else{a=this.knob.getPosition(this.slider).x}this.step=this.getStep(a);this.fireEvent("tick",this.step)}});